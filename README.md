# WebServer

Linux环境下C++实现的轻量级WebServer。

- [WebServer](#webserver)
  - [环境配置](#环境配置)
  - [配置模块](#配置模块)
  - [缓冲区模块](#缓冲区模块)
  - [日志模块](#日志模块)
  - [HTTP模块](#http模块)
  - [线程池模块](#线程池模块)
  - [定时器模块](#定时器模块)
  - [服务器模块](#服务器模块)

## 环境配置

- Ubuntu 24.04.1 LTS
- g++ (Ubuntu 13.2.0-23ubuntu4) 13.2.0
- cmake version 3.28.3
- mysql Ver 8.0.39-0ubuntu0.24.04.2 for Linux on x86_64
- googletest 1.14.0

## 配置模块

[配置模块](/src/config/)提供了一个用于配置服务器参数的类 `Configuration`。
该类通过解析命令行参数来设置服务器的关键配置项，包括端口号、日志写入模式、数据库连接池数量以及线程池内线程数量，解析后的参数作为服务器启动初始化的参数。

**支持的命令行参数如下：**

- -p: 设置服务器端口号，默认值为 8080。
- -c: 设置数据库连接池的连接数量，默认值为 8。
- -t: 设置线程池的线程数量，默认值为 8。
- -l: 设置日志写入模式，0 为异步，1 为同步，默认值为 0。
- -h: 显示帮助信息。

支持多种输入参数格式解析：
- `-p:8080 -l:1 -c:8 -t:8`
- `-p8080 -l1 -c8 -t8`
- `-p8080-l1-c8-t8`

## 缓冲区模块



## 日志模块

**阻塞队列**

- 使用单消费者-多生产者模式的[阻塞队列](src/log/block_queue.h)，将其作为日志异步写入的缓冲区。
- 使用队列互斥锁和条件变量保证了线程安全。

<br>

**日志系统**

- 基于单例模式设计的同步/异步[日志系统](src/log/log.h)。
- 通过阻塞队列在异步模式下存储日志消息，并由负责写入的异步线程完成从阻塞队列消息到日志文件的写入。
- 设置了四种日志级别：`[INFO]`、`[DEBUG]`、`[WARN]`、`[ERROR]`，用于控制日志记录、文件管理和刷新操作。
- 日志系统根据日期清理过期日志文件。
- 使用互斥锁保证了日志文件写入的线程安全。
- 当日期发生变化或当前到达单个日志文件最大行数时，进行日志切换。

## HTTP模块
## 线程池模块
## 定时器模块

- 小顶堆实现的[定时器模块](/src/timer/time.h)。
- 定时器管理：使用小顶堆存储定时器，确保最早到期的定时器总是在堆顶部。
- 回调函数执行：每个定时器均可绑定一个回调函数，定时器到期时自动执行回调。
- 动态更新定时器：支持根据新的超时时间更新已有定时器。
- 清理过期定时器：定时清理所有到期的定时器，保持小顶堆的有效性。
- 定时器堆的维护：通过上浮和下沉操作维护堆的有序性，确保每次操作都保持时间复杂度为`O(log n)`。

## 服务器模块